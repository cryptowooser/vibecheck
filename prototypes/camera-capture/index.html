<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Proto: Camera Capture</title>
    <style>
      :root { color-scheme: dark; }
      body {
        margin: 0;
        background: #0c1317;
        color: #ecfbff;
        font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, sans-serif;
        padding: 1rem;
      }
      .wrap { max-width: 760px; margin: 0 auto; }
      button {
        border: 1px solid #2e6c7b;
        background: #184a56;
        color: #fff;
        border-radius: 10px;
        padding: 0.6rem 0.9rem;
        margin-right: 0.5rem;
      }
      img {
        display: block;
        max-width: 100%;
        border-radius: 10px;
        border: 1px solid #315f6f;
        margin-top: 0.8rem;
      }
      pre {
        white-space: pre-wrap;
        font-family: ui-monospace, SFMono-Regular, Menlo, Consolas, monospace;
        background: #13242a;
        border: 1px solid #294851;
        border-radius: 10px;
        padding: 0.75rem;
      }
    </style>
  </head>
  <body>
    <div class="wrap">
      <h1>Camera Capture Prototype</h1>
      <button id="takePhoto">Take Photo</button>
      <button id="upload" disabled>Upload</button>
      <input id="cameraInput" type="file" accept="image/*" capture="environment" hidden />

      <img id="preview" alt="Preview" hidden />

      <h3>Response</h3>
      <pre id="response">(none)</pre>

      <h3>Log</h3>
      <pre id="log"></pre>
    </div>

    <script>
      const cameraInput = document.getElementById('cameraInput')
      const preview = document.getElementById('preview')
      const uploadBtn = document.getElementById('upload')
      const responseEl = document.getElementById('response')
      const logEl = document.getElementById('log')
      let selectedFile = null

      function log(message) {
        logEl.textContent += `[${new Date().toLocaleTimeString()}] ${message}\n`
        logEl.scrollTop = logEl.scrollHeight
      }

      document.getElementById('takePhoto').addEventListener('click', () => {
        cameraInput.click()
      })

      cameraInput.addEventListener('change', () => {
        if (!cameraInput.files || cameraInput.files.length === 0) {
          return
        }
        selectedFile = cameraInput.files[0]
        const reader = new FileReader()
        reader.onload = () => {
          preview.src = reader.result
          preview.hidden = false
        }
        reader.readAsDataURL(selectedFile)
        uploadBtn.disabled = false
        log(`selected ${selectedFile.name || 'camera-image'} size=${selectedFile.size}`)
      })

      uploadBtn.addEventListener('click', async () => {
        if (!selectedFile) return
        const form = new FormData()
        form.append('image', selectedFile, selectedFile.name || 'capture.jpg')
        log(`uploading ${selectedFile.size} bytes`)

        const response = await fetch('/upload', {
          method: 'POST',
          body: form,
        })
        const payload = await response.json()
        responseEl.textContent = JSON.stringify(payload, null, 2)
        log(`response ${response.status} description=${payload.description}`)
      })

      log('ready')
    </script>
  </body>
</html>
